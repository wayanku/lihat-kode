
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Asset Inspector</title>
    <!-- Menggunakan Prism.js untuk tampilan kode yang cantik -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e1e;
            color: #d4d4d4;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: auto;
        }
        .header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid #333;
        }
        input[type="text"] {
            width: 70%;
            padding: 12px;
            background: #252526;
            border: 1px solid #3e3e42;
            color: white;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            padding: 12px 20px;
            background: #007acc;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
        }
        button:hover { background: #005f9e; }
        .button-group {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
        }
        .action-btn {
            padding: 5px 10px;
            background: #4ec9b0;
            color: black;
            font-size: 12px;
        }
        .action-btn:hover { background: #3aa890; }

        .tabs {
            display: flex;
            margin-top: 20px;
            gap: 5px;
        }
        .tab {
            padding: 10px 20px;
            background: #2d2d2d;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background: #007acc;
            color: white;
        }
        .content-area {
            position: relative; /* Diperlukan untuk positioning tombol copy */
            background: #2d2d2d;
            padding: 20px;
            border-radius: 0 0 5px 5px;
            min-height: 400px;
            overflow: auto;
        }
        .asset-list {
            list-style: none;
            padding: 0;
        }
        .asset-item {
            background: #3e3e42;
            margin-bottom: 5px;
            padding: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .asset-item a {
            color: #4ec9b0;
            text-decoration: none;
            font-size: 14px;
            word-break: break-all;
        }
        .tag {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            margin-left: 10px;
        }
        .tag-js { background: #f1c40f; color: black; }
        .tag-css { background: #3498db; color: white; }
        .tag-img { background: #e67e22; color: white; }
        
        pre {
            margin: 0;
            max-height: 600px;
            overflow: auto;
        }
        .loading {
            display: none;
            color: #f1c40f;
            margin-top: 10px;
        }
        .error-message {
            display: none;
            color: #ff5555;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Web Asset Inspector</h1>
        <p>Tempel URL untuk melihat Source Code, JS, CSS, dan Gambar</p>
        <input type="text" id="urlInput" placeholder="https://example.com" value="">
        <button onclick="analyzeSite()">Analyze</button>
        <div id="loading" class="loading">Sedang mengambil data (ini mungkin butuh waktu)...</div>
        <div id="errorMessage" class="error-message"></div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="showTab('html-tab')">HTML</div>
        <div class="tab" onclick="showTab('js-tab')">JavaScript</div>
        <div class="tab" onclick="showTab('css-tab')">CSS</div>
        <div class="tab" onclick="showTab('img-tab')">Images</div>
        <div class="tab" onclick="showTab('bundle-tab')">Bundled (All-in-One)</div>
    </div>

    <div id="html-tab" class="content-area">
        <pre><code id="htmlCode" class="language-html">Source code akan muncul di sini...</code></pre>
    </div>

    <div id="js-tab" class="content-area" style="display:none;">
        <div id="jsList" class="asset-list">Daftar file JS akan muncul di sini...</div>
    </div>

    <div id="css-tab" class="content-area" style="display:none;">
        <div id="cssList" class="asset-list">Daftar file CSS akan muncul di sini...</div>
    </div>

    <div id="img-tab" class="content-area" style="display:none;">
        <div id="imgList" class="asset-list">Daftar gambar akan muncul di sini...</div>
    </div>

    <div id="bundle-tab" class="content-area" style="display:none;">
        <div class="button-group">
            <button class="action-btn" onclick="downloadBundledHtml()">Unduh HTML</button>
            <button class="action-btn" onclick="copyBundledCode(this)">Salin Kode</button>
        </div>
        <pre><code id="bundleCode" class="language-html">Hasil gabungan akan muncul di sini...</code></pre>
    </div>
</div>

<!-- Library syntax highlighting -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

<script>
    // Variabel untuk menyimpan konten HTML yang sudah digabungkan
    let bundledHtmlContent = '';

    async function analyzeSite() {
        let url = document.getElementById('urlInput').value.trim();
        const errorEl = document.getElementById('errorMessage');
        errorEl.style.display = 'none';

        if (!url) {
            errorEl.textContent = "Masukkan URL!";
            errorEl.style.display = 'block';
            return;
        }
        if (!url.startsWith('http')) url = 'https://' + url;

        const loading = document.getElementById('loading');
        loading.style.display = 'block';
        // Reset tampilan
        document.getElementById('htmlCode').textContent = 'Source code akan muncul di sini...';
        document.getElementById('bundleCode').textContent = 'Hasil gabungan akan muncul di sini...';
        ['jsList', 'cssList', 'imgList'].forEach(id => document.getElementById(id).innerHTML = 'Daftar akan muncul di sini...');

        try {
            // Menggunakan Proxy corsproxy.io yang lebih stabil untuk aset dan konten
            const proxyUrl = `https://corsproxy.io/?` + encodeURIComponent(url);
            const response = await fetch(proxyUrl);

            if (!response.ok) {
                throw new Error(`Proxy Error: ${response.status} ${response.statusText}`);
            }

            const htmlString = await response.text();
            if (!htmlString) throw new Error("Konten tidak ditemukan atau kosong.");

            // 1. Tampilkan Source Code HTML
            const htmlCodeElement = document.getElementById('htmlCode');
            htmlCodeElement.textContent = htmlString;
            Prism.highlightElement(htmlCodeElement);

            // Parsing HTML menggunakan DOMParser
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlString, 'text/html');
            const base = new URL(url);

            // 2. Ambil JS
            renderAssets(doc, 'script', 'src', 'jsList', 'tag-js', 'JS', base);

            // 3. Ambil CSS
            renderAssets(doc, 'link[rel="stylesheet"]', 'href', 'cssList', 'tag-css', 'CSS', base);

            // 4. Ambil Gambar
            renderAssets(doc, 'img', 'src', 'imgList', 'tag-img', 'IMG', base);

            // 5. Buat versi bundled (All-in-One)
            generateAndDisplayBundledHtml(doc, base, url);

            loading.style.display = 'none';
        } catch (error) {
            console.error(error);
            errorEl.textContent = `Gagal mengambil data: ${error.message}`;
            errorEl.style.display = 'block';
            loading.style.display = 'none';
        }
    }

    async function generateAndDisplayBundledHtml(originalDoc, baseUrl, originalUrl) {
        // Buat salinan dokumen agar tidak mengubah 'doc' yang digunakan oleh tab lain
        const doc = originalDoc.cloneNode(true);
        
        // Helper untuk fetch via proxy
        const proxyFetch = (resourceUrl) => {
            const absoluteUrl = new URL(resourceUrl, baseUrl).href;
            return fetch(`https://corsproxy.io/?` + encodeURIComponent(absoluteUrl));
        };

        // Inline CSS
        const cssPromises = Array.from(doc.querySelectorAll('link[rel="stylesheet"]')).map(async (link) => {
            const href = link.getAttribute('href');
            if (!href) return;
            try {
                const response = await proxyFetch(href);
                if (response.ok) {
                    const content = await response.text();
                    const style = doc.createElement('style');
                    style.textContent = content;
                    link.parentNode.replaceChild(style, link);
                }
            } catch (e) {
                console.warn(`Gagal meng-inline CSS: ${href}`, e);
            }
        });

        // Inline JS
        const jsPromises = Array.from(doc.querySelectorAll('script[src]')).map(async (script) => {
            const src = script.getAttribute('src');
            if (!src) return;
            try {
                const response = await proxyFetch(src);
                if (response.ok) {
                    const content = await response.text();
                    const newScript = doc.createElement('script');
                    newScript.textContent = content;
                    // Salin atribut lain seperti 'type' atau 'id' jika ada, kecuali 'src'
                    Array.from(script.attributes).forEach(attr => {
                        if (attr.name !== 'src') newScript.setAttribute(attr.name, attr.value);
                    });
                    script.parentNode.replaceChild(newScript, script);
                }
            } catch (e) {
                console.warn(`Gagal meng-inline JS: ${src}`, e);
            }
        });

        await Promise.all([...cssPromises, ...jsPromises]);

        // Tambahkan komentar di paling atas file
        const comment = doc.createComment(` Bundled by Web Asset Inspector from ${originalUrl} on ${new Date().toUTCString()} `);
        doc.insertBefore(comment, doc.firstChild);

        bundledHtmlContent = doc.documentElement.outerHTML;

        const bundleCodeElement = document.getElementById('bundleCode');
        bundleCodeElement.textContent = bundledHtmlContent;
        Prism.highlightElement(bundleCodeElement);
    }

    function downloadBundledHtml() {
        if (!bundledHtmlContent) {
            alert('Silakan lakukan "Analyze" terlebih dahulu.');
            return;
        }
        const blob = new Blob([bundledHtmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'index.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function copyBundledCode(button) {
        navigator.clipboard.writeText(bundledHtmlContent).then(() => {
            button.textContent = 'Disalin!';
            setTimeout(() => { button.textContent = 'Salin Kode'; }, 2000);
        });
    }

    function renderAssets(doc, selector, attribute, targetId, tagClass, label, baseUrl) {
        const elements = doc.querySelectorAll(selector);
        const listContainer = document.getElementById(targetId);
        listContainer.innerHTML = '';

        if (elements.length === 0) {
            listContainer.innerHTML = '<p>Tidak ditemukan aset.</p>';
            return;
        }

        elements.forEach(el => {
            let attrValue = el.getAttribute(attribute);
            if (attrValue) {
                // Menangani link relatif menjadi link absolut
                if (!attrValue.startsWith('http')) {
                    try {
                        attrValue = new URL(attrValue, baseUrl).href;
                    } catch(e) {}
                }

                const item = document.createElement('div');
                item.className = 'asset-item';
                item.innerHTML = `
                    <a href="${attrValue}" target="_blank">${attrValue}</a>
                    <span class="tag ${tagClass}">${label}</span>
                `;
                listContainer.appendChild(item);
            }
        });
    }

    function showTab(tabId) {
        document.querySelectorAll('.content-area').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabId).style.display = 'block';
        event.currentTarget.classList.add('active');
    }
</script>

</body>
</html>
